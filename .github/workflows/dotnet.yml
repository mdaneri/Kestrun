name: .NET and PowerShell Tests

on:
  push:
    paths:
      - '**/*.cs'
      - '**/*.csproj'
      - '**/*.sln'
      - '**/*.ps1'
      - '**/*.psm1'
      - '**/*.psd1'
      - '**/*.yml'
      - '**/*.yaml'
      - tests/**
  pull_request:
    paths:
      - '**/*.cs'
      - '**/*.csproj'
      - '**/*.sln'
      - '**/*.ps1'
      - '**/*.psm1'
      - '**/*.psd1'
      - '**/*.yml'
      - '**/*.yaml'
      - tests/**

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: ğŸ›ï¸ Checkout
      uses: actions/checkout@v4

    - name: ğŸ§° Setup .NET 8
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: '8.0.x'

    - name: ğŸ§° Setup .NET 9
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: '9.0.x'

    - name: ğŸ§° Install Module Invoke-Build
      shell: pwsh
      run: |
        if (-not (Get-Module -ListAvailable -Name InvokeBuild)) {
          Install-Module -Name InvokeBuild -Force -Scope CurrentUser
        }

    - name: ğŸ§° Install Module Pester
      shell: pwsh
      run: |
        if (-not (Get-Module -ListAvailable -Name Pester)) {
          Install-Module -Name Pester -Force -Scope CurrentUser
        }

    - name: ğŸ§¾ Log Pester Version
      shell: pwsh
      run: |
        Get-Module Pester -ListAvailable | Select-Object Name, Version, Path

    - name: ğŸ”§ Run C# Build
      shell: pwsh
      run: |
        Invoke-Build Build

    - name: ğŸ§ª Run Tests
      shell: pwsh
      run: |
        Invoke-Build Test
    
